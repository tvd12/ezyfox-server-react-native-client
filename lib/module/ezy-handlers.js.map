{"version":3,"sources":["ezy-handlers.js"],"names":["Util","Const","Entity","EzyRSAProxy","EzyLogger","EzyConnectionSuccessHandler","constructor","clientType","clientVersion","handle","client","setStatus","EzyConnectionStatus","CONNECTED","sendHandshakeRequest","postHandle","generateClientKey","clientKey","send","EzyCommand","HANDSHAKE","newHandshakeRequest","clientId","getClientId","token","getStoredToken","request","push","isEnableSSL","enableSSL","enableDebug","isEmpty","callback","getInstance","generateKeyPair","keyPair","privateKey","publicKey","EzyGuid","generate","EzyConnectionFailureHandler","event","warn","reason","config","reconnectConfig","reconnect","should","shouldReconnect","mustReconnect","enable","FAILURE","success","onReconnecting","onConnectionFailed","EzyDisconnectionHandler","reasonName","EzyDisconnectReasons","getDisconnectReasonName","info","preHandle","reconnectEnable","EzyDisconnectReason","UNAUTHORIZED","CLOSE","DISCONNECTED","onDisconnected","ANOTHER_SESSION_LOGIN","EzyEventHandlers","handlers","addHandler","eventType","handler","getHandler","data","EzyHandshakeHandler","startPing","doHandle","onSessionKeyDecrypted","sessionKey","setSessionKey","handleLogin","sessionToken","sessionId","decryptSessionKey","encryptedSessionKey","error","close","decrypt","loginRequest","getLoginRequest","LOGIN","encryptedLoginRequest","startPingSchedule","EzyLoginSuccessHandler","zoneId","zoneName","userId","username","responseData","zone","EzyZone","user","EzyUser","me","handleLoginSuccess","name","EzyLoginErrorHandler","disconnect","handleLoginError","EzyAppAccessHandler","appManager","app","newApp","addApp","appId","appName","EzyApp","EzyAppExitHandler","reasonId","removeApp","EzyAppResponseHandler","cmd","commandData","getAppById","getDataHandler","EzyPluginInfoHandler","pluginManager","plugin","newPlugin","addPlugin","pluginId","pluginName","EzyPlugin","EzyPluginResponseHandler","getPluginById","EzyPongHandler","EzyDataHandlers","EzyAppDataHandlers","EzyPluginDataHandlers"],"mappings":"AAAA,OAAOA,IAAP,MAAiB,YAAjB;AACA,OAAOC,KAAP,MAAkB,iBAAlB;AACA,OAAOC,MAAP,MAAmB,gBAAnB;AACA,SAAQC,WAAR,QAA0B,aAA1B;AACA,OAAOC,SAAP,MAAsB,cAAtB;;AAEA,MAAMC,2BAAN,CAAkC;AAE9BC,EAAAA,WAAW,GAAG;AACV,SAAKC,UAAL,GAAkB,cAAlB;AACA,SAAKC,aAAL,GAAqB,OAArB;AACH;;AAEDC,EAAAA,MAAM,GAAG;AACL,SAAKC,MAAL,CAAYC,SAAZ,CAAsBV,KAAK,CAACW,mBAAN,CAA0BC,SAAhD;AACA,SAAKC,oBAAL;AACA,SAAKC,UAAL;AACH;;AAEDA,EAAAA,UAAU,GAAG,CACZ;;AAEDD,EAAAA,oBAAoB,GAAG;AACnB,SAAKE,iBAAL,CAAwBC,SAAD,IAAe;AAClC,WAAKP,MAAL,CAAYQ,IAAZ,CAAiBjB,KAAK,CAACkB,UAAN,CAAiBC,SAAlC,EAA6C,KAAKC,mBAAL,CAAyBJ,SAAzB,CAA7C;AACH,KAFD;AAGH;;AAEDI,EAAAA,mBAAmB,CAACJ,SAAD,EAAY;AAC3B,QAAIK,QAAQ,GAAG,KAAKC,WAAL,EAAf;AACA,QAAIC,KAAK,GAAG,KAAKC,cAAL,EAAZ;AACA,QAAIC,OAAO,GAAG,EAAd;AACAA,IAAAA,OAAO,CAACC,IAAR,CAAaL,QAAb;AACAI,IAAAA,OAAO,CAACC,IAAR,CAAaV,SAAb;AACAS,IAAAA,OAAO,CAACC,IAAR,CAAa,KAAKpB,UAAlB;AACAmB,IAAAA,OAAO,CAACC,IAAR,CAAa,KAAKnB,aAAlB;AACAkB,IAAAA,OAAO,CAACC,IAAR,CAAa,KAAKC,WAAL,CAAiBX,SAAjB,CAAb;AACAS,IAAAA,OAAO,CAACC,IAAR,CAAaH,KAAb;AACA,WAAOE,OAAP;AACH;;AAEDE,EAAAA,WAAW,CAACX,SAAD,EAAY;AACnB,QAAG,KAAKP,MAAL,CAAYmB,SAAZ,IACC,KAAKnB,MAAL,CAAYoB,WADb,KAEE,CAACb,SAAD,IAAaA,SAAS,CAACc,OAFzB,CAAH,EAEsC;AAC9B,aAAO,KAAP;AACP;;AACD,WAAO,KAAKrB,MAAL,CAAYmB,SAAnB;AACD;;AAEDb,EAAAA,iBAAiB,CAACgB,QAAD,EAAW;AAC1B,QAAG,KAAKtB,MAAL,CAAYmB,SAAf,EAA0B;AACtB1B,MAAAA,WAAW,CAAC8B,WAAZ,GAA0BC,eAA1B,CAA2CC,OAAD,IAAa;AACnD,aAAKzB,MAAL,CAAY0B,UAAZ,GAAyBD,OAAO,CAACC,UAAjC;AACAJ,QAAAA,QAAQ,CAACG,OAAO,CAACE,SAAT,CAAR;AACH,OAHD;AAIH,KALD,MAMK;AACDL,MAAAA,QAAQ;AACX;AACJ;;AAEDT,EAAAA,WAAW,GAAG;AACV,WAAOvB,IAAI,CAACsC,OAAL,CAAaC,QAAb,EAAP;AACH;;AAEDd,EAAAA,cAAc,GAAG;AACb,WAAO,EAAP;AACH;;AA9D6B,C,CAkElC;;;AAEA,MAAMe,2BAAN,CAAkC;AAE9B/B,EAAAA,MAAM,CAACgC,KAAD,EAAQ;AACVrC,IAAAA,SAAS,CAACsC,IAAV,CAAe,kCAAkCD,KAAK,CAACE,MAAvD;AACA,QAAIC,MAAM,GAAG,KAAKlC,MAAL,CAAYkC,MAAzB;AACA,QAAIC,eAAe,GAAGD,MAAM,CAACE,SAA7B;AACA,QAAIC,MAAM,GAAG,KAAKC,eAAL,CAAqBP,KAArB,CAAb;AACA,QAAIQ,aAAa,GAAGJ,eAAe,CAACK,MAAhB,IAA0BH,MAA9C;AACA,SAAKrC,MAAL,CAAYC,SAAZ,CAAsBV,KAAK,CAACW,mBAAN,CAA0BuC,OAAhD;;AACA,QAAGF,aAAH,EAAkB;AACd,WAAKvC,MAAL,CAAYoC,SAAZ,CAAsBM,OAAO,IAAI;AAC7B,YAAGA,OAAH,EAAY;AACR,eAAKC,cAAL,CAAoBZ,KAApB;AACH,SAFD,MAGK;AACD,eAAKa,kBAAL,CAAwBb,KAAxB;AACH;;AACD,aAAK1B,UAAL,CAAgB0B,KAAhB;AACH,OARD;AASH,KAVD,MAWK;AACD,WAAKa,kBAAL,CAAwBb,KAAxB;AACA,WAAK1B,UAAL,CAAgB0B,KAAhB;AACH;AACJ;;AAEDO,EAAAA,eAAe,CAACP,KAAD,EAAQ;AACnB,WAAO,IAAP;AACH;;AAEDY,EAAAA,cAAc,CAACZ,KAAD,EAAQ,CACrB;;AAEDa,EAAAA,kBAAkB,CAACb,KAAD,EAAQ,CACzB;;AAED1B,EAAAA,UAAU,CAAC0B,KAAD,EAAQ,CACjB;;AArC6B,C,CAyClC;;;AAEA,MAAMc,uBAAN,CAA8B;AAC1B9C,EAAAA,MAAM,CAACgC,KAAD,EAAQ;AACV,QAAIE,MAAM,GAAGF,KAAK,CAACE,MAAnB;AACA,QAAIa,UAAU,GAAGvD,KAAK,CAACwD,oBAAN,CAA2BC,uBAA3B,CAAmDf,MAAnD,CAAjB;AACAvC,IAAAA,SAAS,CAACuD,IAAV,CAAe,oCAAoCH,UAAnD;AACA,SAAKI,SAAL,CAAenB,KAAf;AACA,QAAIG,MAAM,GAAG,KAAKlC,MAAL,CAAYkC,MAAzB;AACA,QAAIC,eAAe,GAAGD,MAAM,CAACE,SAA7B;AACA,QAAIC,MAAM,GAAG,KAAKC,eAAL,CAAqBP,KAArB,CAAb;AACA,QAAIoB,eAAe,GAAGhB,eAAe,CAACK,MAAtC;AACA,QAAID,aAAa,GAAGY,eAAe,IAC/BlB,MAAM,IAAI1C,KAAK,CAAC6D,mBAAN,CAA0BC,YADpB,IAEhBpB,MAAM,IAAI1C,KAAK,CAAC6D,mBAAN,CAA0BE,KAFpB,IAGhBjB,MAHJ;AAIA,SAAKrC,MAAL,CAAYC,SAAZ,CAAsBV,KAAK,CAACW,mBAAN,CAA0BqD,YAAhD;;AACA,QAAGhB,aAAH,EAAkB;AACd,WAAKvC,MAAL,CAAYoC,SAAZ,CAAsBM,OAAO,IAAI;AAC7B,YAAGA,OAAH,EAAY;AACR,eAAKC,cAAL,CAAoBZ,KAApB;AACH,SAFD,MAGK;AACD,eAAKyB,cAAL,CAAoBzB,KAApB;AACH;;AACD,aAAK1B,UAAL,CAAgB0B,KAAhB;AACH,OARD;AASH,KAVD,MAWK;AACD,WAAKyB,cAAL,CAAoBzB,KAApB;AACA,WAAK1B,UAAL,CAAgB0B,KAAhB;AACH;AACJ;;AAEDmB,EAAAA,SAAS,CAACnB,KAAD,EAAQ,CAChB;;AAEDO,EAAAA,eAAe,CAACP,KAAD,EAAQ;AACnB,QAAIE,MAAM,GAAGF,KAAK,CAACE,MAAnB;;AACA,QAAGA,MAAM,IAAI1C,KAAK,CAAC6D,mBAAN,CAA0BK,qBAAvC,EAA8D;AAC1D,aAAO,KAAP;AACH;;AACD,WAAO,IAAP;AACH;;AAEDd,EAAAA,cAAc,CAACZ,KAAD,EAAQ,CACrB;;AAEDyB,EAAAA,cAAc,CAACzB,KAAD,EAAQ,CACrB;;AAED1B,EAAAA,UAAU,CAAC0B,KAAD,EAAQ,CACjB;;AAlDyB,C,CAqD9B;;;AAEA,MAAM2B,gBAAN,CAAuB;AACnB9D,EAAAA,WAAW,CAACI,MAAD,EAAS;AAChB,SAAK2D,QAAL,GAAgB,EAAhB;AACA,SAAK3D,MAAL,GAAcA,MAAd;AACH;;AAED4D,EAAAA,UAAU,CAACC,SAAD,EAAYC,OAAZ,EAAqB;AAC3BA,IAAAA,OAAO,CAAC9D,MAAR,GAAiB,KAAKA,MAAtB;AACA,SAAK2D,QAAL,CAAcE,SAAd,IAA2BC,OAA3B;AACH;;AAEDC,EAAAA,UAAU,CAACF,SAAD,EAAY;AAClB,QAAIC,OAAO,GAAG,KAAKH,QAAL,CAAcE,SAAd,CAAd;AACA,WAAOC,OAAP;AACH;;AAED/D,EAAAA,MAAM,CAAC8D,SAAD,EAAYG,IAAZ,EAAkB;AACpB,QAAIF,OAAO,GAAG,KAAKC,UAAL,CAAgBF,SAAhB,CAAd;AACA,QAAGC,OAAH,EACIA,OAAO,CAAC/D,MAAR,CAAeiE,IAAf,EADJ,KAGItE,SAAS,CAACsC,IAAV,CAAe,gCAAgC6B,SAA/C;AACP;;AAtBkB,C,CAyBvB;;;AAEA,MAAMI,mBAAN,CAA0B;AAEzBlE,EAAAA,MAAM,CAACiE,IAAD,EAAO;AACZ,SAAKE,SAAL;AACA,SAAKC,QAAL,CAAcH,IAAd;AACA;;AAEEI,EAAAA,qBAAqB,CAACJ,IAAD,EAAOK,UAAP,EAAmB3B,OAAnB,EAA4B;AAC7C,QAAG2B,UAAH,EAAe;AACX,WAAKrE,MAAL,CAAYsE,aAAZ,CAA0BD,UAA1B;AACH;;AACD,QAAG3B,OAAH,EAAY;AACV,WAAK6B,WAAL;AACD;;AACD,SAAKlE,UAAL,CAAgB2D,IAAhB;AACD;;AAEHG,EAAAA,QAAQ,CAACH,IAAD,EAAO;AACX,SAAKhE,MAAL,CAAYwE,YAAZ,GAA2BR,IAAI,CAAC,CAAD,CAA/B;AACA,SAAKhE,MAAL,CAAYyE,SAAZ,GAAwBT,IAAI,CAAC,CAAD,CAA5B;;AACA,QAAG,KAAKhE,MAAL,CAAYmB,SAAf,EAA0B;AACtB,WAAKuD,iBAAL,CAAuBV,IAAI,CAAC,CAAD,CAA3B,EAAgC,CAACK,UAAD,EAAa3B,OAAb,KAAyB;AACrD,aAAK0B,qBAAL,CAA2BJ,IAA3B,EAAiCK,UAAjC,EAA6C3B,OAA7C;AACH,OAFD;AAGH,KAJD,MAKK;AACD,WAAK0B,qBAAL,CAA2BJ,IAA3B,EAAiC,IAAjC,EAAuC,IAAvC;AACH;AACJ;;AAEDU,EAAAA,iBAAiB,CAACC,mBAAD,EAAsBrD,QAAtB,EAAgC;AAC7C,QAAGqD,mBAAmB,IAAI,IAA1B,EAAgC;AAC5B,UAAG,KAAK3E,MAAL,CAAYoB,WAAf,EAA4B;AACxBE,QAAAA,QAAQ,CAAC,IAAD,EAAO,IAAP,CAAR;AACA;AACH;;AACD5B,MAAAA,SAAS,CAACkF,KAAV,CAAgB,mHAAhB;AACA,WAAK5E,MAAL,CAAY6E,KAAZ;AACAvD,MAAAA,QAAQ,CAAC,IAAD,EAAO,KAAP,CAAR;AACA;AACH;;AACD7B,IAAAA,WAAW,CAAC8B,WAAZ,GAA0BuD,OAA1B,CAAkCH,mBAAlC,EAAuD,KAAK3E,MAAL,CAAY0B,UAAnE,EAAgF2C,UAAD,IAAgB;AAC3F/C,MAAAA,QAAQ,CAAC+C,UAAD,EAAa,IAAb,CAAR;AACH,KAFD;AAGH;;AAEJhE,EAAAA,UAAU,CAAC2D,IAAD,EAAO,CACb;;AAEJO,EAAAA,WAAW,GAAG;AACb,QAAIQ,YAAY,GAAG,KAAKC,eAAL,EAAnB;AACM,SAAKhF,MAAL,CAAYQ,IAAZ,CAAiBjB,KAAK,CAACkB,UAAN,CAAiBwE,KAAlC,EAAyCF,YAAzC,EAAuD,KAAKG,qBAAL,EAAvD;AACH;;AAEDA,EAAAA,qBAAqB,GAAG;AACpB,WAAO,KAAP;AACH;;AAEDF,EAAAA,eAAe,GAAG;AACd,WAAO,CAAC,MAAD,EAAS,MAAT,EAAiB,MAAjB,EAAyB,EAAzB,CAAP;AACN;;AAEDd,EAAAA,SAAS,GAAG;AACX,SAAKlE,MAAL,CAAYmF,iBAAZ;AACA;;AAhEwB,C,CAmE1B;;;AAEA,MAAMC,sBAAN,CAA6B;AACzBrF,EAAAA,MAAM,CAACiE,IAAD,EAAO;AACT,QAAIqB,MAAM,GAAGrB,IAAI,CAAC,CAAD,CAAjB;AACA,QAAIsB,QAAQ,GAAGtB,IAAI,CAAC,CAAD,CAAnB;AACA,QAAIuB,MAAM,GAAGvB,IAAI,CAAC,CAAD,CAAjB;AACA,QAAIwB,QAAQ,GAAGxB,IAAI,CAAC,CAAD,CAAnB;AACA,QAAIyB,YAAY,GAAGzB,IAAI,CAAC,CAAD,CAAvB;AAEA,QAAI0B,IAAI,GAAG,IAAIlG,MAAM,CAACmG,OAAX,CAAmB,KAAK3F,MAAxB,EAAgCqF,MAAhC,EAAwCC,QAAxC,CAAX;AACA,QAAIM,IAAI,GAAG,IAAIpG,MAAM,CAACqG,OAAX,CAAmBN,MAAnB,EAA2BC,QAA3B,CAAX;AACA,SAAKxF,MAAL,CAAY8F,EAAZ,GAAiBF,IAAjB;AACA,SAAK5F,MAAL,CAAY0F,IAAZ,GAAmBA,IAAnB;AACA,SAAKK,kBAAL,CAAwBN,YAAxB;AACA/F,IAAAA,SAAS,CAACuD,IAAV,CAAe,WAAW2C,IAAI,CAACI,IAAhB,GAAuB,yBAAtC;AACH;;AAEDD,EAAAA,kBAAkB,CAACN,YAAD,EAAe,CAChC;;AAjBwB;;AAoB7B,MAAMQ,oBAAN,CAA2B;AACvBlG,EAAAA,MAAM,CAACiE,IAAD,EAAO;AACT,SAAKhE,MAAL,CAAYkG,UAAZ,CAAuB,GAAvB;AACA,SAAKC,gBAAL,CAAsBnC,IAAtB;AACH;;AAEDmC,EAAAA,gBAAgB,CAACnC,IAAD,EAAO,CACtB;;AAPsB,C,CAU3B;;;AAEA,MAAMoC,mBAAN,CAA0B;AACtBrG,EAAAA,MAAM,CAACiE,IAAD,EAAO;AACT,QAAI0B,IAAI,GAAG,KAAK1F,MAAL,CAAY0F,IAAvB;AACA,QAAIW,UAAU,GAAGX,IAAI,CAACW,UAAtB;AACA,QAAIC,GAAG,GAAG,KAAKC,MAAL,CAAYb,IAAZ,EAAkB1B,IAAlB,CAAV;AACAqC,IAAAA,UAAU,CAACG,MAAX,CAAkBF,GAAlB;AACA,SAAKjG,UAAL,CAAgBiG,GAAhB,EAAqBtC,IAArB;AACAtE,IAAAA,SAAS,CAACuD,IAAV,CAAe,iBAAiBqD,GAAG,CAACN,IAArB,GAA4B,eAA3C;AACH;;AAEDO,EAAAA,MAAM,CAACb,IAAD,EAAO1B,IAAP,EAAa;AACf,QAAIyC,KAAK,GAAGzC,IAAI,CAAC,CAAD,CAAhB;AACA,QAAI0C,OAAO,GAAG1C,IAAI,CAAC,CAAD,CAAlB;AACA,QAAIsC,GAAG,GAAG,IAAI9G,MAAM,CAACmH,MAAX,CAAkB,KAAK3G,MAAvB,EAA+B0F,IAA/B,EAAqCe,KAArC,EAA4CC,OAA5C,CAAV;AACA,WAAOJ,GAAP;AACH;;AAEDjG,EAAAA,UAAU,CAACiG,GAAD,EAAMtC,IAAN,EAAY,CACrB;;AAlBqB,C,CAqB1B;;;AAEA,MAAM4C,iBAAN,CAAwB;AACpB7G,EAAAA,MAAM,CAACiE,IAAD,EAAO;AACT,QAAI0B,IAAI,GAAG,KAAK1F,MAAL,CAAY0F,IAAvB;AACA,QAAIW,UAAU,GAAGX,IAAI,CAACW,UAAtB;AACA,QAAII,KAAK,GAAGzC,IAAI,CAAC,CAAD,CAAhB;AACA,QAAI6C,QAAQ,GAAG7C,IAAI,CAAC,CAAD,CAAnB;AACA,QAAIsC,GAAG,GAAGD,UAAU,CAACS,SAAX,CAAqBL,KAArB,CAAV;;AACA,QAAGH,GAAH,EAAQ;AACJ,WAAKjG,UAAL,CAAgBiG,GAAhB,EAAqBtC,IAArB;AACAtE,MAAAA,SAAS,CAACuD,IAAV,CAAe,oBAAoBqD,GAAG,CAACN,IAAxB,GAA+B,YAA/B,GAA8Ca,QAA7D;AACH;AACJ;;AAEDxG,EAAAA,UAAU,CAACiG,GAAD,EAAMtC,IAAN,EAAY,CACrB;;AAdmB,C,CAkBxB;;;AAEA,MAAM+C,qBAAN,CAA4B;AACxBhH,EAAAA,MAAM,CAACiE,IAAD,EAAO;AACT,QAAIyC,KAAK,GAAGzC,IAAI,CAAC,CAAD,CAAhB;AACA,QAAIyB,YAAY,GAAGzB,IAAI,CAAC,CAAD,CAAvB;AACA,QAAIgD,GAAG,GAAGvB,YAAY,CAAC,CAAD,CAAtB;AACA,QAAIwB,WAAW,GAAGxB,YAAY,CAAC,CAAD,CAA9B;AAEA,QAAIa,GAAG,GAAG,KAAKtG,MAAL,CAAYkH,UAAZ,CAAuBT,KAAvB,CAAV;AACA,QAAI3C,OAAO,GAAGwC,GAAG,CAACa,cAAJ,CAAmBH,GAAnB,CAAd;AACA,QAAGlD,OAAH,EACIA,OAAO,CAACwC,GAAD,EAAMW,WAAN,CAAP,CADJ,KAGIvH,SAAS,CAACsC,IAAV,CAAe,UAAUsE,GAAG,CAACN,IAAd,GAAqB,+BAArB,GAAuDgB,GAAtE;AACP;;AAbuB,C,CAgB5B;;;AAEA,MAAMI,oBAAN,CAA2B;AACvBrH,EAAAA,MAAM,CAACiE,IAAD,EAAO;AACT,QAAI0B,IAAI,GAAG,KAAK1F,MAAL,CAAY0F,IAAvB;AACA,QAAI2B,aAAa,GAAG3B,IAAI,CAAC2B,aAAzB;AACA,QAAIC,MAAM,GAAG,KAAKC,SAAL,CAAe7B,IAAf,EAAqB1B,IAArB,CAAb;AACAqD,IAAAA,aAAa,CAACG,SAAd,CAAwBF,MAAxB;AACA,SAAKjH,UAAL,CAAgBiH,MAAhB,EAAwBtD,IAAxB;AACAtE,IAAAA,SAAS,CAACuD,IAAV,CAAe,qBAAqBqE,MAAM,CAACtB,IAA5B,GAAmC,oBAAlD;AACH;;AAEDuB,EAAAA,SAAS,CAAC7B,IAAD,EAAO1B,IAAP,EAAa;AAClB,QAAIyD,QAAQ,GAAGzD,IAAI,CAAC,CAAD,CAAnB;AACA,QAAI0D,UAAU,GAAG1D,IAAI,CAAC,CAAD,CAArB;AACA,QAAIsD,MAAM,GAAG,IAAI9H,MAAM,CAACmI,SAAX,CAAqB,KAAK3H,MAA1B,EAAkC0F,IAAlC,EAAwC+B,QAAxC,EAAkDC,UAAlD,CAAb;AACA,WAAOJ,MAAP;AACH;;AAEDjH,EAAAA,UAAU,CAACiH,MAAD,EAAStD,IAAT,EAAe,CACxB;;AAlBsB,C,CAqB3B;;;AAEA,MAAM4D,wBAAN,CAA+B;AAC3B7H,EAAAA,MAAM,CAACiE,IAAD,EAAO;AACT,QAAIyD,QAAQ,GAAGzD,IAAI,CAAC,CAAD,CAAnB;AACA,QAAIyB,YAAY,GAAGzB,IAAI,CAAC,CAAD,CAAvB;AACA,QAAIgD,GAAG,GAAGvB,YAAY,CAAC,CAAD,CAAtB;AACA,QAAIwB,WAAW,GAAGxB,YAAY,CAAC,CAAD,CAA9B;AAEA,QAAI6B,MAAM,GAAG,KAAKtH,MAAL,CAAY6H,aAAZ,CAA0BJ,QAA1B,CAAb;AACA,QAAI3D,OAAO,GAAGwD,MAAM,CAACH,cAAP,CAAsBH,GAAtB,CAAd;AACA,QAAGlD,OAAH,EACIA,OAAO,CAACwD,MAAD,EAASL,WAAT,CAAP,CADJ,KAGIvH,SAAS,CAACuD,IAAV,CAAe,aAAaqE,MAAM,CAACtB,IAApB,GAA2B,+BAA3B,GAA6DgB,GAA5E;AACP;;AAb0B,C,CAgB/B;;;AAEA,MAAMc,cAAN,CAAqB;AACjB/H,EAAAA,MAAM,CAACiE,IAAD,EAAO,CACZ;;AAFgB,C,CAKrB;;;AAEA,MAAM+D,eAAN,CAAsB;AAClBnI,EAAAA,WAAW,CAACI,MAAD,EAAS;AAChB,SAAK2D,QAAL,GAAgB,EAAhB;AACA,SAAK3D,MAAL,GAAcA,MAAd;AACH;;AAED4D,EAAAA,UAAU,CAACoD,GAAD,EAAMlD,OAAN,EAAe;AACrBA,IAAAA,OAAO,CAAC9D,MAAR,GAAiB,KAAKA,MAAtB;AACA,SAAK2D,QAAL,CAAcqD,GAAd,IAAqBlD,OAArB;AACH;;AAEDC,EAAAA,UAAU,CAACiD,GAAD,EAAM;AACZ,QAAIlD,OAAO,GAAG,KAAKH,QAAL,CAAcqD,GAAd,CAAd;AACA,WAAOlD,OAAP;AACH;;AAED/D,EAAAA,MAAM,CAACiH,GAAD,EAAMhD,IAAN,EAAY;AACd,QAAIF,OAAO,GAAG,KAAKC,UAAL,CAAgBiD,GAAhB,CAAd;AACA,QAAGlD,OAAH,EACIA,OAAO,CAAC/D,MAAR,CAAeiE,IAAf,EADJ,KAGItE,SAAS,CAACsC,IAAV,CAAe,kCAAkCgF,GAAjD;AACP;;AAtBiB,C,CAyBtB;;;AAEA,MAAMgB,kBAAN,CAAyB;AAErBpI,EAAAA,WAAW,GAAG;AACV,SAAK+D,QAAL,GAAgB,EAAhB;AACH;;AAEDC,EAAAA,UAAU,CAACoD,GAAD,EAAMlD,OAAN,EAAe;AACrB,SAAKH,QAAL,CAAcqD,GAAd,IAAqBlD,OAArB;AACH;;AAEDC,EAAAA,UAAU,CAACiD,GAAD,EAAM;AACZ,QAAIlD,OAAO,GAAG,KAAKH,QAAL,CAAcqD,GAAd,CAAd;AACA,WAAOlD,OAAP;AACH;;AAboB,C,CAiBzB;;;AAEA,MAAMmE,qBAAN,CAA4B;AAExBrI,EAAAA,WAAW,GAAG;AACV,SAAK+D,QAAL,GAAgB,EAAhB;AACH;;AAEDC,EAAAA,UAAU,CAACoD,GAAD,EAAMlD,OAAN,EAAe;AACrB,SAAKH,QAAL,CAAcqD,GAAd,IAAqBlD,OAArB;AACH;;AAEDC,EAAAA,UAAU,CAACiD,GAAD,EAAM;AACZ,QAAIlD,OAAO,GAAG,KAAKH,QAAL,CAAcqD,GAAd,CAAd;AACA,WAAOlD,OAAP;AACH;;AAbuB,C,CAiB5B;;;AAEA,eAAe;AACXnE,EAAAA,2BADW;AAEXmC,EAAAA,2BAFW;AAGXe,EAAAA,uBAHW;AAIXa,EAAAA,gBAJW;AAKXO,EAAAA,mBALW;AAMXmB,EAAAA,sBANW;AAOXa,EAAAA,oBAPW;AAQXG,EAAAA,mBARW;AASXQ,EAAAA,iBATW;AAUXG,EAAAA,qBAVW;AAWXK,EAAAA,oBAXW;AAYXQ,EAAAA,wBAZW;AAaXE,EAAAA,cAbW;AAcXE,EAAAA,kBAdW;AAeXC,EAAAA,qBAfW;AAgBXF,EAAAA;AAhBW,CAAf","sourcesContent":["import Util from './ezy-util'\nimport Const from './ezy-constants'\nimport Entity from './ezy-entities'\nimport {EzyRSAProxy} from './ezy-codec'\nimport EzyLogger from './ezy-logger'\n\nclass EzyConnectionSuccessHandler {\n\n    constructor() {\n        this.clientType = \"REACT_NATIVE\";\n        this.clientVersion = \"1.0.0\";\n    }\n\n    handle() {\n        this.client.setStatus(Const.EzyConnectionStatus.CONNECTED);\n        this.sendHandshakeRequest();\n        this.postHandle();\n    }\n\n    postHandle() {\n    }\n\n    sendHandshakeRequest() {\n        this.generateClientKey((clientKey) => {\n            this.client.send(Const.EzyCommand.HANDSHAKE, this.newHandshakeRequest(clientKey))\n        });\n    }\n\n    newHandshakeRequest(clientKey) {\n        var clientId = this.getClientId();\n        var token = this.getStoredToken();\n        var request = [];\n        request.push(clientId);\n        request.push(clientKey);\n        request.push(this.clientType);\n        request.push(this.clientVersion);\n        request.push(this.isEnableSSL(clientKey));\n        request.push(token);\n        return request;\n    }\n\n    isEnableSSL(clientKey) {\n        if(this.client.enableSSL &&\n            this.client.enableDebug &&\n            (!clientKey|| clientKey.isEmpty)) {\n                return false;\n        }\n        return this.client.enableSSL;\n      }\n\n      generateClientKey(callback) {\n        if(this.client.enableSSL) {\n            EzyRSAProxy.getInstance().generateKeyPair((keyPair) => {\n                this.client.privateKey = keyPair.privateKey;\n                callback(keyPair.publicKey);\n            });\n        }\n        else {\n            callback();\n        }\n    }\n\n    getClientId() {\n        return Util.EzyGuid.generate();\n    }\n\n    getStoredToken() {\n        return \"\";\n    }\n\n}\n\n//=======================================================\n\nclass EzyConnectionFailureHandler {\n\n    handle(event) {\n        EzyLogger.warn(\"connection failure, reason = \" + event.reason);\n        var config = this.client.config;\n        var reconnectConfig = config.reconnect;\n        var should = this.shouldReconnect(event);\n        var mustReconnect = reconnectConfig.enable && should;\n        this.client.setStatus(Const.EzyConnectionStatus.FAILURE);\n        if(mustReconnect) {\n            this.client.reconnect(success => {\n                if(success) {\n                    this.onReconnecting(event);\n                }\n                else {\n                    this.onConnectionFailed(event);\n                }\n                this.postHandle(event);\n            });\n        }\n        else {\n            this.onConnectionFailed(event);\n            this.postHandle(event);\n        }\n    }\n\n    shouldReconnect(event) {\n        return true;\n    }\n\n    onReconnecting(event) {\n    }\n\n    onConnectionFailed(event) {\n    }\n\n    postHandle(event) {\n    }\n\n}\n\n//=======================================================\n\nclass EzyDisconnectionHandler {\n    handle(event) {\n        var reason = event.reason;\n        var reasonName = Const.EzyDisconnectReasons.getDisconnectReasonName(reason);\n        EzyLogger.info(\"handle disconnection, reason = \" + reasonName);\n        this.preHandle(event);\n        var config = this.client.config;\n        var reconnectConfig = config.reconnect;\n        var should = this.shouldReconnect(event);\n        var reconnectEnable = reconnectConfig.enable;\n        var mustReconnect = reconnectEnable &&\n            reason != Const.EzyDisconnectReason.UNAUTHORIZED &&\n            reason != Const.EzyDisconnectReason.CLOSE &&\n            should;\n        this.client.setStatus(Const.EzyConnectionStatus.DISCONNECTED);\n        if(mustReconnect) {\n            this.client.reconnect(success => {\n                if(success) {\n                    this.onReconnecting(event);\n                }\n                else {\n                    this.onDisconnected(event);\n                }\n                this.postHandle(event);\n            });\n        }\n        else {\n            this.onDisconnected(event);\n            this.postHandle(event);\n        }\n    }\n\n    preHandle(event) {\n    }\n\n    shouldReconnect(event) {\n        var reason = event.reason;\n        if(reason == Const.EzyDisconnectReason.ANOTHER_SESSION_LOGIN) {\n            return false;\n        }\n        return true;\n    }\n\n    onReconnecting(event) {\n    }\n\n    onDisconnected(event) {\n    }\n\n    postHandle(event) {\n    }\n}\n\n//======================================\n\nclass EzyEventHandlers {\n    constructor(client) {\n        this.handlers = {};\n        this.client = client;\n    }\n\n    addHandler(eventType, handler) {\n        handler.client = this.client;\n        this.handlers[eventType] = handler;\n    }\n\n    getHandler(eventType) {\n        var handler = this.handlers[eventType];\n        return handler;\n    }\n\n    handle(eventType, data) {\n        var handler = this.getHandler(eventType);\n        if(handler)\n            handler.handle(data);\n        else\n            EzyLogger.warn(\"has no handler with event: \" + eventType);\n    }\n}\n\n//======================================\n\nclass EzyHandshakeHandler {\n\n\thandle(data) {\n\t\tthis.startPing();\n\t\tthis.doHandle(data);\n\t}\n\n    onSessionKeyDecrypted(data, sessionKey, success) {\n        if(sessionKey) {\n            this.client.setSessionKey(sessionKey);\n        }\n        if(success) {\n          this.handleLogin();\n        }\n        this.postHandle(data);\n      }\n\n    doHandle(data) {\n        this.client.sessionToken = data[1];\n        this.client.sessionId = data[2];\n        if(this.client.enableSSL) {\n            this.decryptSessionKey(data[3], (sessionKey, success) => {\n                this.onSessionKeyDecrypted(data, sessionKey, success)\n            });\n        }\n        else {\n            this.onSessionKeyDecrypted(data, null, true);\n        }\n    }\n\n    decryptSessionKey(encryptedSessionKey, callback) {\n        if(encryptedSessionKey == null) {\n            if(this.client.enableDebug) {\n                callback(null, true);\n                return;\n            }\n            EzyLogger.error(\"maybe server was not enable SSL, you must enable SSL on server or disable SSL on your client or enable debug mode\");\n            this.client.close();\n            callback(null, false);\n            return;\n        }\n        EzyRSAProxy.getInstance().decrypt(encryptedSessionKey, this.client.privateKey, (sessionKey) => {\n            callback(sessionKey, true)\n        });\n    }\n\n\tpostHandle(data) {\n    }\n\n\thandleLogin() {\n\t\tvar loginRequest = this.getLoginRequest();\n        this.client.send(Const.EzyCommand.LOGIN, loginRequest, this.encryptedLoginRequest());\n    }\n\n    encryptedLoginRequest() {\n        return false;\n    }\n    \n    getLoginRequest() {\n        return [\"test\", \"test\", \"test\", []];\n\t}\n\t\n\tstartPing() {\n\t\tthis.client.startPingSchedule();\n\t}\n}\n\n//=======================================================\n\nclass EzyLoginSuccessHandler {\n    handle(data) {\n        var zoneId = data[0];\n        var zoneName = data[1];\n        var userId = data[2];\n        var username = data[3];\n        var responseData = data[4];\n\n        var zone = new Entity.EzyZone(this.client, zoneId, zoneName);\n        var user = new Entity.EzyUser(userId, username);\n        this.client.me = user;\n        this.client.zone = zone;\n        this.handleLoginSuccess(responseData);\n        EzyLogger.info(\"user: \" + user.name + \" logged in successfully\");\n    }\n\n    handleLoginSuccess(responseData) {\n    }\n}\n\nclass EzyLoginErrorHandler {\n    handle(data) {\n        this.client.disconnect(401);\n        this.handleLoginError(data);\n    }\n\n    handleLoginError(data) {\n    }\n}\n\n//=======================================================\n\nclass EzyAppAccessHandler {\n    handle(data) {\n        var zone = this.client.zone;\n        var appManager = zone.appManager;\n        var app = this.newApp(zone, data);\n        appManager.addApp(app);\n        this.postHandle(app, data);\n        EzyLogger.info(\"access app: \" + app.name + \" successfully\");\n    }\n\n    newApp(zone, data) {\n        var appId = data[0];\n        var appName = data[1];\n        var app = new Entity.EzyApp(this.client, zone, appId, appName);\n        return app;\n    }\n\n    postHandle(app, data) {\n    }\n}\n\n//======================================\n\nclass EzyAppExitHandler {\n    handle(data) {\n        var zone = this.client.zone;\n        var appManager = zone.appManager\n        var appId = data[0];\n        var reasonId = data[1];\n        var app = appManager.removeApp(appId);\n        if(app) {\n            this.postHandle(app, data);\n            EzyLogger.info(\"user exit app: \" + app.name + \", reason: \" + reasonId);\n        }\n    }\n\n    postHandle(app, data) {\n    }\n\n}\n\n//=======================================================\n\nclass EzyAppResponseHandler {\n    handle(data) {\n        var appId = data[0];\n        var responseData = data[1];\n        var cmd = responseData[0];\n        var commandData = responseData[1];\n\n        var app = this.client.getAppById(appId);\n        var handler = app.getDataHandler(cmd);\n        if(handler)\n            handler(app, commandData);\n        else\n            EzyLogger.warn(\"app: \" + app.name + \" has no handler for command: \" + cmd);\n    }\n}\n\n//======================================\n\nclass EzyPluginInfoHandler {\n    handle(data) {\n        var zone = this.client.zone;\n        var pluginManager = zone.pluginManager;\n        var plugin = this.newPlugin(zone, data);\n        pluginManager.addPlugin(plugin);\n        this.postHandle(plugin, data);\n        EzyLogger.info(\"request plugin: \" + plugin.name + \" info successfully\");\n    }\n\n    newPlugin(zone, data) {\n        var pluginId = data[0];\n        var pluginName = data[1];\n        var plugin = new Entity.EzyPlugin(this.client, zone, pluginId, pluginName);\n        return plugin;\n    }\n\n    postHandle(plugin, data) {\n    }\n}\n\n//======================================\n\nclass EzyPluginResponseHandler {\n    handle(data) {\n        var pluginId = data[0];\n        var responseData = data[1];\n        var cmd = responseData[0];\n        var commandData = responseData[1];\n\n        var plugin = this.client.getPluginById(pluginId);\n        var handler = plugin.getDataHandler(cmd);\n        if(handler)\n            handler(plugin, commandData);\n        else\n            EzyLogger.info(\"plugin: \" + plugin.name + \" has no handler for command: \" + cmd);\n    }\n}\n\n//=======================================================\n\nclass EzyPongHandler {\n    handle(data) {\n    }\n}\n\n//=======================================================\n\nclass EzyDataHandlers {\n    constructor(client) {\n        this.handlers = {};\n        this.client = client;\n    }\n\n    addHandler(cmd, handler) {\n        handler.client = this.client;\n        this.handlers[cmd] = handler;\n    }\n\n    getHandler(cmd) {\n        var handler = this.handlers[cmd];\n        return handler;\n    }\n\n    handle(cmd, data) {\n        var handler = this.getHandler(cmd);\n        if(handler)\n            handler.handle(data);\n        else\n            EzyLogger.warn(\"has no handler with command: \" + cmd);\n    }\n}\n\n//=======================================================\n\nclass EzyAppDataHandlers {\n\n    constructor() {\n        this.handlers = {}\n    }\n\n    addHandler(cmd, handler) {\n        this.handlers[cmd] = handler;\n    }\n\n    getHandler(cmd) {\n        var handler = this.handlers[cmd];\n        return handler;\n    }\n\n}\n\n//======================================\n\nclass EzyPluginDataHandlers {\n\n    constructor() {\n        this.handlers = {}\n    }\n\n    addHandler(cmd, handler) {\n        this.handlers[cmd] = handler;\n    }\n\n    getHandler(cmd) {\n        var handler = this.handlers[cmd];\n        return handler;\n    }\n\n}\n\n//=======================================================\n\nexport default { \n    EzyConnectionSuccessHandler,\n    EzyConnectionFailureHandler,\n    EzyDisconnectionHandler,\n    EzyEventHandlers,\n    EzyHandshakeHandler,\n    EzyLoginSuccessHandler,\n    EzyLoginErrorHandler,\n    EzyAppAccessHandler,\n    EzyAppExitHandler,\n    EzyAppResponseHandler,\n    EzyPluginInfoHandler,\n    EzyPluginResponseHandler,\n    EzyPongHandler,\n    EzyAppDataHandlers,\n    EzyPluginDataHandlers,\n    EzyDataHandlers\n}"]}